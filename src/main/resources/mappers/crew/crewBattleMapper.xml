<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.multipjt.multi_pjt.crew.dao.battle.CrewBattleMapper">

    <!-- 배틀 생성 --> 

    <insert id="createCrewBattleRow"
            parameterType="com.multipjt.multi_pjt.crew.domain.battle.CrewBattleRequestDTO">
        INSERT INTO CrewBattle(battle_id, battle_name, battle_goal, battle_end_recruitment, battle_end_date, battle_content, battle_state, crew_id)
        VALUES(#{battle_id}, #{battle_name}, #{battle_goal}, #{battle_end_recruitment}, #{battle_end_date}, #{battle_content}, #{battle_state}, #{crew_id});
    </insert>

    <!-- 배틀 목록 조회 --> 

    <select id="selectCrewBattleRow"
            resultType="com.multipjt.multi_pjt.crew.domain.battle.CrewBattleResponseDTO">
            SELECT battle_id, battle_name, battle_goal, battle_end_recruitment, battle_end_date, battle_content, battle_state, crew_id
            FROM CrewBattle
            WHERE crew_id = #{crew_id}
            ORDER BY battle_state;
    </select>
    
    <!-- 배틀 신청 --> 

    <insert id="createBattleMemberRow"
            parameterType="com.multipjt.multi_pjt.crew.domain.battle.BattleMemberRequestDTO">
        INSERT INTO BattleMember(participant_id, battle_id, member_id)
        VALUES(#{participant_id}, #{battle_id}, #{member_id});
    </insert>    

    <!-- 배틀 참가 멤버 조회 --> 

    <select id="selectBattleMemberRow"
            resultType="com.multipjt.multi_pjt.crew.domain.battle.BattleMemberResponseDTO">
        SELECT participant_id, battle_id, member_id
        FROM BattleMember
        WHERE battle_id = #{battle_id};
    </select>

    <!-- 피드 작성 --> 

    <insert id="createCrewBattleFeedRow"
            parameterType="com.multipjt.multi_pjt.crew.domain.battle.CrewBattleFeedRequestDTO">
            INSERT INTO CrewBattleFeed(feed_id, feed_img, feed_post, feed_kcal, feed_sport, feed_time, participant_id)
            VALUES(#{feed_id}, #{feed_img}, #{feed_post}, #{feed_kcal}, #{feed_sport}, #{feed_time}, #{participant_id});
    </insert>

    <!-- 피드 조회 --> 

    <select id="selectCrewBattleFeedRow"
            resultType="com.multipjt.multi_pjt.crew.domain.battle.CrewBattleFeedResponseDTO">
        SELECT feed_id, feed_img, feed_post, feed_kcal, feed_sport, feed_time, participant_id
        FROM CrewBattleFeed
        WHERE participant_id = #{participant_id};
    </select>

    <!-- 투표 --> 

    <insert id="createVoteRow"
            parameterType="com.multipjt.multi_pjt.crew.domain.battle.CrewVoteRequestDTO">
        INSERT INTO CrewVote(vote_id, battle_id, participant_id, member_id)
        VALUES(#{vote_id}, #{battle_id}, #{participant_id}, #{member_id});
    </insert>
</mapper>